<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: auto; padding: 1rem; }
    h1 { text-align: center; }
    input, button { width: 100%; margin-bottom: 0.5rem; padding: 0.5rem; font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
    td button { width: auto; padding: 0.3rem 0.5rem; margin: 0 2px; }
  </style>
</head>
<body>
  <h1>üè¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>

  <input type="text" id="id" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
  <input type="text" id="location" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö">
  <button onclick="addItem()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>

  <input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." onkeyup="renderItems()">

  <table>
    <thead>
      <tr><th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzt2cmc5oH8w2Z60O54w5anPDPYga0WXHNibhzFj_50UOjYA-90OWy04LKt8p7fInqL/exec";
let items = [];

function fetchItems() {
  fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      items = data;
      renderItems();
    });
}

function renderItems() {
  const keyword = document.getElementById('search').value.trim().toLowerCase();
  const body = document.getElementById('tableBody');
  body.innerHTML = '';
  items.filter(item =>
    item['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'].toLowerCase().includes(keyword) ||
    item['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö'].toLowerCase().includes(keyword)
  ).forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input value="${item['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤']}" onchange="editItem(this, '${item._row}', 'id')"></td>
      <td><input value="${item['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö']}" onchange="editItem(this, '${item._row}', 'location')"></td>
      <td>${item['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà']}</td>
      <td>
        <button onclick="deleteItem('${item._row}')">‚ùå</button>
      </td>
    `;
    body.appendChild(tr);
  });
}

function addItem() {
  const id = document.getElementById('id').value.trim();
  const location = document.getElementById('location').value.trim();
  const date = new Date().toISOString().split('T')[0];
  if (!id || !location) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

  fetch(scriptURL, {
    method: 'POST',
    body: JSON.stringify({ action: "add", id, location, date }),
  }).then(() => {
    document.getElementById('id').value = '';
    document.getElementById('location').value = '';
    fetchItems();
  });
}

function deleteItem(row) {
  if (!confirm("‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
  fetch(scriptURL, {
    method: 'POST',
    body: JSON.stringify({ action: "delete", row })
  }).then(fetchItems);
}

function editItem(input, row, field) {
  const id = field === 'id' ? input.value : input.parentElement.parentElement.children[0].children[0].value;
  const location = field === 'location' ? input.value : input.parentElement.parentElement.children[1].children[0].value;
  const date = new Date().toISOString().split('T')[0];

  fetch(scriptURL, {
    method: 'POST',
    body: JSON.stringify({ action: "update", row, id, location, date })
  });
}

fetchItems();
</script>
</body>
</html>
